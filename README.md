# bot

ربات تلگرامی با پنل مدیریت تحت وب.

## اجرای ربات تلگرام

```bash
pip install -r requirements.txt  # در صورت استفاده از فایل نیازمندی‌ها
python -m app.main
```

## اجرای پنل وب ادمین

1. در فایل `.env` مقادیر زیر را تنظیم کنید:
   ```env
   ADMIN_WEB_USER=admin
   ADMIN_WEB_PASS=very-secret
   ADMIN_WEB_BIND=0.0.0.0
   ADMIN_WEB_PORT=8080
   ```
2. پیش‌نیازها را نصب کنید:
   ```bash
   pip install fastapi uvicorn jinja2 python-dotenv
   ```
3. سرور وب را اجرا کنید:
   ```bash
   python admin_web.py
   ```

پنل وب شامل داشبورد، مدیریت سفارش‌ها، مشاهده کاربران و گزارش تراکنش‌های کیف پول است و به صورت پیش‌فرض روی پورت 8080 در دسترس خواهد بود.

## تغییرات و امکانات جدید

- صفحهٔ «کدهای تخفیف» به پنل مدیریت افزوده شد؛ از این بخش می‌توانید برای هر محصول، کد تخفیف با تاریخ انقضا، سقف استفاده و وضعیت فعال/غیرفعال ثبت و ویرایش کنید و تاریخچهٔ استفادهٔ هر کد را ببینید.
- هنگام انتخاب روش پرداخت (کارت، کیف پول یا ترکیبی) در ربات، ابتدا از کاربر سؤال می‌شود که آیا کد تخفیف دارد یا خیر؛ در صورت تأیید، امکان وارد کردن و اعمال کد فراهم است و پس از اعمال، خلاصهٔ سفارش با مبلغ نهایی نمایش داده می‌شود.
- برای سفارش‌هایی که با طرح خرید اول و وضعیت «تحویل شد» ثبت شده‌اند، در صفحهٔ سفارش دکمهٔ «درخواست پرداخت طرح اول» اضافه شده است که پیام یادآوری پرداخت را به کاربر همراه با لینک‌های پرداخت ارسال می‌کند.
- در پرداخت ترکیبی، پیش از وارد کردن مبلغ، موجودی فعلی کیف پول به کاربر نمایش داده می‌شود تا تصمیم‌گیری راحت‌تر شود.
